<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CapCrit System Test v4.0.0</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            background: #2a2a2a;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #00ff00;
        }
        .success { color: #00ff00; }
        .error { color: #ff0000; }
        .warning { color: #ffaa00; }
        .info { color: #00aaff; }
        pre {
            background: #0a0a0a;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>🎯 CapCrit System Test v4.0.0</h1>
    <h2>EXACT 100% CRITICAL INSTANT KILL VALIDATION</h2>
    
    <div id="test-output"></div>
    
    <!-- Load CapCrit System -->
    <script src="capcrit.js"></script>
    
    <script>
        // Test output container
        const output = document.getElementById('test-output');
        
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = message;
            output.appendChild(div);
        }
        
        function section(title) {
            const div = document.createElement('div');
            div.className = 'test-section';
            div.innerHTML = `<h3>${title}</h3>`;
            output.appendChild(div);
            return div;
        }
        
        // Real character data from database
        const characters = {
            sesshoumaru: {
                name: "Sesshoumaru",
                critico: 70,
                isMeditating: false
            },
            loki: {
                name: "Loki",
                critico: 50,
                isMeditating: false
            },
            merlin: {
                name: "Merlin", 
                critico: 100,
                isMeditating: false
            },
            merlinMeditating: {
                name: "Merlin (Meditating)",
                critico: 100,
                isMeditating: true
            }
        };

        // Run Tests
        log('🎯 <strong>CapCrit System Test v4.0.0 - EXACT 100% INSTANT KILL VALIDATION</strong>', 'success');
        log('================================================<br>', 'info');

        // Test 1: Character Critical Calculations
        const section1 = section('📊 TEST 1: Character Critical Calculations');
        
        Object.values(characters).forEach(character => {
            if (!character.isMeditating) {
                const validation = CapCrit.validateCharacter(character);
                section1.innerHTML += `<pre>
✅ <strong>${character.name}</strong> validated:
   Character Critical: ${validation.characterCritical}%
   Final Critical: ${validation.finalCritical}%
   Instant Kill Capable: ${validation.hasInstantKillCapability}
   Classification: ${validation.classification}
</pre>`;
            }
        });

        // Test 2: Instant Kill Rights Verification  
        const section2 = section('💀 TEST 2: Instant Kill Rights Verification');
        
        const sesshoumaru = characters.sesshoumaru;
        const loki = characters.loki; 
        const merlin = characters.merlin;

        const sesshoumaruRights = CapCrit.hasInstantKill(sesshoumaru, 30);
        const lokiRights = CapCrit.hasInstantKill(loki, 30);
        const merlinRights = CapCrit.hasInstantKill(merlin, 30);
        
        section2.innerHTML += `<pre>
🏹 <strong>Sesshoumaru (70 crítico):</strong>
   30% + 70% = 100% EXACT
   Result: ${sesshoumaruRights ? '<span class="success">INSTANT KILL CAPABLE ✅</span>' : '<span class="error">Normal Critical Only ❌</span>'}

🥊 <strong>Loki (50 crítico):</strong>  
   30% + 50% = 80%
   Result: ${lokiRights ? '<span class="error">INSTANT KILL CAPABLE ❌</span>' : '<span class="success">Normal Critical Only ✅</span>'}

✨ <strong>Merlin (100 crítico):</strong>
   30% + 100% = 130% (capped to 100% but not exact)
   Result: ${merlinRights ? '<span class="error">INSTANT KILL CAPABLE ❌</span>' : '<span class="success">Normal Critical Only ✅</span>'}
</pre>`;

        // Test 3: Battle Simulations
        const section3 = section('⚔️ TEST 3: Battle Simulations');

        const battle1 = CapCrit.simulate(sesshoumaru, loki, false);
        const battle2 = CapCrit.simulate(sesshoumaru, characters.merlinMeditating, true);
        const battle3 = CapCrit.simulate(loki, sesshoumaru, false);
        
        section3.innerHTML += `<pre>
🏹 <strong>Scenario 1: Sesshoumaru vs Loki (no meditation)</strong>
   Outcome: <span class="warning">${battle1.outcome}</span>
   ${battle1.explanation}

🏹 <strong>Scenario 2: Sesshoumaru vs Merlin (Merlin meditating)</strong>
   Outcome: <span class="info">${battle2.outcome}</span>
   ${battle2.explanation}

🥊 <strong>Scenario 3: Loki vs Sesshoumaru (Loki attacking)</strong>
   Outcome: <span class="info">${battle3.outcome}</span>
   ${battle3.explanation}
</pre>`;

        // Test 4: System Report
        const section4 = section('📋 TEST 4: Complete System Report');
        
        const allCharacters = [sesshoumaru, loki, merlin];
        const systemReport = CapCrit.generateReport(allCharacters);
        
        section4.innerHTML += `<pre>
📊 <strong>Summary:</strong> ${systemReport.summary.totalCharacters} characters tested
💀 <strong>Instant Killers:</strong> ${systemReport.summary.instantKillersCount} (${systemReport.summary.instantKillPercentage})
⚡ <strong>Normal Fighters:</strong> ${systemReport.summary.normalFightersCount}
🎯 <strong>Instant Kill Capable:</strong> ${systemReport.instantKillers.join(', ')}
</pre>`;

        // Final Results
        const section5 = section('🎯 TEST RESULTS SUMMARY');
        section5.innerHTML += `<pre class="success">
✅ <strong>CapCrit System v4.0.0 Test Complete!</strong>
✅ Only Sesshoumaru (100% exact) can instant kill
✅ Meditation provides instant kill protection  
✅ Loki and Merlin do normal critical damage only
✅ Arsenal Adaptativo v4.0.0 integrated successfully
✅ Balance achieved - exact precision required
</pre>`;

        log('<br><strong>🎮 Test completed successfully! Open browser console for detailed logs.</strong>', 'success');
    </script>
</body>
</html>