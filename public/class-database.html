<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RPGStack - Classes Database Manager v4.0.0</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #020617 0%, #0f172a 50%, #0d7377 100%);
            min-height: 100vh;
            padding: 10px;
            margin: 0;
        }

        .container {
            width: 100%;
            max-width: none;
            margin: 0 auto;
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border-radius: 20px;
            box-shadow: 0 25px 75px rgba(0,0,0,0.4);
            min-height: calc(100vh - 20px);
            display: flex;
            flex-direction: column;
            border: 1px solid rgba(65, 234, 212, 0.1);
        }

        .header {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #f8fafc;
            padding: 30px;
            text-align: center;
            position: relative;
            border-radius: 20px 20px 0 0;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #41eadc 0%, #10b981 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .subtitle {
            font-size: 1.1em;
            opacity: 0.8;
            margin-bottom: 15px;
        }

        .nav-links {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .nav-link {
            padding: 8px 16px;
            background: rgba(65, 234, 212, 0.1);
            border: 1px solid rgba(65, 234, 212, 0.2);
            border-radius: 8px;
            color: #41eadc;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .nav-link:hover {
            background: rgba(65, 234, 212, 0.2);
            transform: translateY(-2px);
        }

        .nav-link.active {
            background: #41eadc;
            color: #0f172a;
        }

        .server-status {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .server-online {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .server-offline {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .main-content {
            display: flex;
            flex: 1;
            gap: 20px;
            padding: 20px;
        }

        .form-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            width: 380px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .database-section {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
        }

        .section-title {
            font-size: 1.4em;
            font-weight: 600;
            color: #41eadc;
            margin-bottom: 20px;
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #e2e8f0;
            font-weight: 500;
            font-size: 0.9em;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.3);
            color: #f8fafc;
            font-size: 0.95em;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #41eadc;
            box-shadow: 0 0 0 3px rgba(65, 234, 212, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .form-row-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
        }

        .form-actions {
            margin-top: 30px;
            display: flex;
            gap: 15px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95em;
            flex: 1;
        }

        .btn-primary {
            background: linear-gradient(135deg, #41eadc 0%, #10b981 100%);
            color: #0f172a;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(65, 234, 212, 0.3);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #e2e8f0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .loading-indicator {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: #41eadc;
            padding: 20px 30px;
            border-radius: 10px;
            font-weight: 600;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .loading-indicator.show {
            opacity: 1;
            pointer-events: auto;
        }

        .database-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .search-box {
            flex: 1;
            min-width: 200px;
            padding: 10px 15px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.3);
            color: #f8fafc;
            font-size: 0.9em;
        }

        .search-box:focus {
            outline: none;
            border-color: #41eadc;
        }

        .view-toggle {
            display: flex;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 2px;
        }

        .view-btn {
            padding: 8px 12px;
            border: none;
            background: transparent;
            color: #e2e8f0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8em;
        }

        .view-btn.active {
            background: #41eadc;
            color: #0f172a;
        }

        .classes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .class-card {
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            position: relative;
        }

        .class-card:hover {
            transform: translateY(-5px);
            border-color: rgba(65, 234, 212, 0.3);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .class-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .class-name {
            font-size: 1.3em;
            font-weight: 700;
            color: #41eadc;
        }

        .class-id {
            background: rgba(65, 234, 212, 0.2);
            color: #41eadc;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.75em;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .class-id:hover {
            background: rgba(65, 234, 212, 0.3);
        }

        .class-description {
            color: #cbd5e1;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .class-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .stat-item {
            background: rgba(0, 0, 0, 0.2);
            padding: 8px 12px;
            border-radius: 6px;
            text-align: center;
        }

        .stat-label {
            font-size: 0.8em;
            color: #94a3b8;
            margin-bottom: 2px;
        }

        .stat-value {
            font-weight: 600;
            color: #e2e8f0;
        }

        .class-advantages {
            margin-bottom: 15px;
        }

        .advantage-badge,
        .disadvantage-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75em;
            font-weight: 600;
            margin: 2px;
        }

        .advantage-badge {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }

        .disadvantage-badge {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .class-skills {
            margin-bottom: 15px;
        }

        .skills-title {
            font-size: 0.9em;
            color: #94a3b8;
            margin-bottom: 8px;
        }

        .skill-item {
            background: rgba(138, 43, 226, 0.1);
            border: 1px solid rgba(138, 43, 226, 0.2);
            padding: 6px 10px;
            border-radius: 6px;
            margin: 4px 2px;
            display: inline-block;
            font-size: 0.8em;
            color: #c4b5fd;
        }

        .class-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 0.8em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .edit-btn {
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .edit-btn:hover {
            background: rgba(59, 130, 246, 0.3);
        }

        .delete-btn {
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .delete-btn:hover {
            background: rgba(239, 68, 68, 0.3);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            font-weight: 600;
            z-index: 1000;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
            max-width: 400px;
        }

        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }

        .notification.success {
            background: rgba(34, 197, 94, 0.9);
            color: #ffffff;
            border: 1px solid rgba(34, 197, 94, 1);
        }

        .notification.error {
            background: rgba(239, 68, 68, 0.9);
            color: #ffffff;
            border: 1px solid rgba(239, 68, 68, 1);
        }

        .notification.info {
            background: rgba(59, 130, 246, 0.9);
            color: #ffffff;
            border: 1px solid rgba(59, 130, 246, 1);
        }

        .generator-section {
            background: rgba(138, 43, 226, 0.1);
            border: 2px solid rgba(138, 43, 226, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .generator-title {
            color: #c4b5fd;
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
        }

        .algorithm-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .rarity-badges {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }

        .rarity-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .rarity-badge.common {
            background: rgba(156, 163, 175, 0.2);
            color: #9ca3af;
            border: 1px solid rgba(156, 163, 175, 0.3);
        }

        .rarity-badge.rare {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .rarity-badge.epic {
            background: rgba(138, 43, 226, 0.2);
            color: #a855f7;
            border: 1px solid rgba(138, 43, 226, 0.3);
        }

        .rarity-badge.legendary {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .rarity-badge.active {
            box-shadow: 0 0 10px currentColor;
            transform: scale(1.05);
        }

        .empty-state {
            text-align: center;
            color: #64748b;
            padding: 60px 20px;
        }

        .empty-state h3 {
            font-size: 1.5em;
            margin-bottom: 10px;
        }

        @media (max-width: 1024px) {
            .main-content {
                flex-direction: column;
            }
            
            .form-section {
                width: 100%;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .form-row-3 {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 2em;
            }

            .nav-links {
                gap: 10px;
            }

            .nav-link {
                padding: 6px 12px;
                font-size: 0.8em;
            }

            .classes-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .algorithm-controls {
                grid-template-columns: 1fr;
            }

            .form-row-3 {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="server-status" id="serverStatus">🔄 Conectando...</div>
            <h1>Classes Database</h1>
            <p class="subtitle">Sistema Inteligente de Gestão de Classes v4.0.0</p>
            
            <nav class="nav-links">
                <a href="/" class="nav-link">🏠 Home</a>
                <a href="/characters" class="nav-link">👥 Characters</a>
                <a href="/skills" class="nav-link">⚔️ Skills</a>
                <a href="/classes" class="nav-link active">🎯 Classes</a>
                <a href="/maps" class="nav-link">🗺️ Maps</a>
            </nav>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Form Section -->
            <div class="form-section">
                <h2 class="section-title">🧠 Gerador de Classes</h2>
                
                <!-- Class Generator -->
                <div class="generator-section">
                    <h3 class="generator-title">🎯 Algoritmo Inteligente</h3>
                    
                    <form id="classGeneratorForm">
                        <div class="form-group">
                            <label for="className">Nome da Classe</label>
                            <input type="text" id="className" placeholder="Ex: Paladino, Assassino, Necromante" required>
                        </div>

                        <div class="form-group">
                            <label for="classArchetype">Arquétipo Base</label>
                            <select id="classArchetype" required>
                                <option value="">Selecione um arquétipo</option>
                                <option value="combate">Combate (Físico)</option>
                                <option value="magia">Magia (Místico)</option>
                                <option value="suporte">Suporte (Utilitário)</option>
                                <option value="hibrido">Híbrido (Balanceado)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Raridade da Classe</label>
                            <div class="rarity-badges">
                                <div class="rarity-badge common" data-rarity="common">Common</div>
                                <div class="rarity-badge rare" data-rarity="rare">Rare</div>
                                <div class="rarity-badge epic" data-rarity="epic">Epic</div>
                                <div class="rarity-badge legendary" data-rarity="legendary">Legendary</div>
                            </div>
                            <input type="hidden" id="classRarity" value="common">
                        </div>

                        <div class="form-group">
                            <label for="classDescription">Descrição</label>
                            <textarea id="classDescription" rows="3" placeholder="Descreva o conceito da classe..."></textarea>
                        </div>

                        <h4 style="color: #c4b5fd; margin: 20px 0 10px 0; font-size: 1em;">⚖️ Distribuição de Atributos</h4>
                        <div class="algorithm-controls">
                            <div class="form-group">
                                <label for="statAttack">Ataque (0.5 - 2.0)</label>
                                <input type="range" id="statAttack" min="0.5" max="2.0" step="0.1" value="1.0">
                                <span class="stat-display">1.0x</span>
                            </div>
                            <div class="form-group">
                                <label for="statDefense">Defesa (0.5 - 2.0)</label>
                                <input type="range" id="statDefense" min="0.5" max="2.0" step="0.1" value="1.0">
                                <span class="stat-display">1.0x</span>
                            </div>
                            <div class="form-group">
                                <label for="statAnima">Ânima (0.5 - 2.0)</label>
                                <input type="range" id="statAnima" min="0.5" max="2.0" step="0.1" value="1.0">
                                <span class="stat-display">1.0x</span>
                            </div>
                            <div class="form-group">
                                <label for="statSpeed">Velocidade (0.5 - 2.0)</label>
                                <input type="range" id="statSpeed" min="0.5" max="2.0" step="0.1" value="1.0">
                                <span class="stat-display">1.0x</span>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary" id="generateBtn">
                                🧠 Gerar Classe
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="clearGeneratorForm()">
                                🔄 Limpar
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Manual Class Creation -->
                <div style="margin-top: 30px;">
                    <h3 style="color: #41eadc; text-align: center; margin-bottom: 15px;">✍️ Criação Manual</h3>
                    <form id="manualClassForm">
                        <div class="form-group">
                            <label for="manualName">Nome da Classe</label>
                            <input type="text" id="manualName" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="manualDescription">Descrição</label>
                            <textarea id="manualDescription" rows="3" required></textarea>
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                ➕ Criar Classe
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Database Section -->
            <div class="database-section">
                <h2 class="section-title">📊 Classes Registradas</h2>
                
                <!-- Database Controls -->
                <div class="database-controls">
                    <input type="text" class="search-box" id="searchBox" placeholder="🔍 Buscar classes...">
                    
                    <div class="view-toggle">
                        <button class="view-btn active" onclick="setViewMode('cards')">📋 Cards</button>
                        <button class="view-btn" onclick="setViewMode('table')">📊 Tabela</button>
                    </div>
                    
                    <button class="btn btn-secondary" onclick="refreshClasses()">🔄 Atualizar</button>
                </div>

                <!-- Classes Grid -->
                <div id="classesGrid" class="classes-grid">
                    <div class="empty-state">
                        <h3>Nenhuma classe encontrada</h3>
                        <p>Use o gerador de classes ou crie uma manualmente.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Indicator -->
    <div class="loading-indicator" id="loadingIndicator">
        🔄 Processando...
    </div>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <script src="ClassManager.js"></script>
    <script src="ClassGenerator.js"></script>
    <script src="ClassIntegration.js"></script>
    <script>
        // Global variables
        const API_BASE = 'http://localhost:3002/api';
        let serverOnline = false;
        let viewMode = 'cards';
        let allClasses = {};
        
        // Initialize application
        document.addEventListener('DOMContentLoaded', async function() {
            await checkServerStatus();
            await loadClasses();
            setupEventListeners();
            setInterval(checkServerStatus, 30000); // Check every 30s
        });

        // Check server status
        async function checkServerStatus() {
            try {
                const response = await fetch(`${API_BASE}/test`);
                const result = await response.json();
                serverOnline = response.ok;
                updateServerStatus(true);
            } catch (error) {
                serverOnline = false;
                updateServerStatus(false);
            }
        }

        // Update server status indicator
        function updateServerStatus(online) {
            const statusEl = document.getElementById('serverStatus');
            if (online) {
                statusEl.textContent = '✅ Online';
                statusEl.className = 'server-status server-online';
            } else {
                statusEl.textContent = '❌ Offline';
                statusEl.className = 'server-status server-offline';
            }
        }

        // Load classes from API
        async function loadClasses() {
            if (!serverOnline) return;
            
            try {
                showLoading(true);
                
                // For now, load base classes (will be replaced with actual API)
                allClasses = getBaseClasses();
                renderClasses(allClasses);
                
                showNotification('Classes carregadas com sucesso!', 'success');
            } catch (error) {
                console.error('Erro ao carregar classes:', error);
                showNotification('Erro ao carregar classes', 'error');
            } finally {
                showLoading(false);
            }
        }

        // Get base classes (temporary - will be replaced with API)
        function getBaseClasses() {
            return {
                'CLASS_001': {
                    id: 'CLASS_001',
                    name: 'Lutador',
                    description: 'Especialista em combate corpo a corpo com alta resistência',
                    archetype: 'combate',
                    rarity: 'common',
                    stats: {
                        attack: 1.2,
                        defense: 1.1,
                        anima: 0.9,
                        speed: 1.0
                    },
                    advantages: ['Armamentista'],
                    disadvantages: ['Arcano'],
                    skills: ['Cadência do Dragão'],
                    created_at: '2025-09-01T05:00:00.000Z'
                },
                'CLASS_002': {
                    id: 'CLASS_002',
                    name: 'Armamentista',
                    description: 'Especialista em combate à distância com precisão letal',
                    archetype: 'combate',
                    rarity: 'common',
                    stats: {
                        attack: 1.1,
                        defense: 1.0,
                        anima: 1.0,
                        speed: 1.1
                    },
                    advantages: ['Arcano'],
                    disadvantages: ['Lutador'],
                    skills: ['Arsenal Adaptativo'],
                    created_at: '2025-09-01T05:00:00.000Z'
                },
                'CLASS_003': {
                    id: 'CLASS_003',
                    name: 'Arcano',
                    description: 'Mestre das artes místicas com manipulação de Ânima',
                    archetype: 'magia',
                    rarity: 'common',
                    stats: {
                        attack: 1.0,
                        defense: 0.9,
                        anima: 1.3,
                        speed: 0.9
                    },
                    advantages: ['Lutador'],
                    disadvantages: ['Armamentista'],
                    skills: ['Convergência Ânima'],
                    created_at: '2025-09-01T05:00:00.000Z'
                }
            };
        }

        // Render classes in current view mode
        function renderClasses(classes) {
            const container = document.getElementById('classesGrid');
            
            if (!classes || Object.keys(classes).length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>Nenhuma classe encontrada</h3>
                        <p>Use o gerador de classes ou crie uma manualmente.</p>
                    </div>
                `;
                return;
            }

            if (viewMode === 'cards') {
                renderClassCards(classes);
            } else {
                renderClassTable(classes);
            }
        }

        // Render classes as cards
        function renderClassCards(classes) {
            const container = document.getElementById('classesGrid');
            const classesArray = Object.values(classes);
            
            container.innerHTML = classesArray.map(classData => `
                <div class="class-card">
                    <div class="class-header">
                        <div class="class-name">${classData.name}</div>
                        <div class="class-id" onclick="copyToClipboard('${classData.id}')" title="Clique para copiar">
                            ${classData.id}
                        </div>
                    </div>
                    
                    <div class="class-description">${classData.description}</div>
                    
                    <div class="class-stats">
                        <div class="stat-item">
                            <div class="stat-label">Ataque</div>
                            <div class="stat-value">${classData.stats.attack}x</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Defesa</div>
                            <div class="stat-value">${classData.stats.defense}x</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Ânima</div>
                            <div class="stat-value">${classData.stats.anima}x</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Velocidade</div>
                            <div class="stat-value">${classData.stats.speed}x</div>
                        </div>
                    </div>
                    
                    <div class="class-advantages">
                        <strong style="color: #94a3b8; font-size: 0.9em;">Vantagens:</strong><br>
                        ${classData.advantages.map(adv => `<span class="advantage-badge">+${adv}</span>`).join('')}
                        <br>
                        <strong style="color: #94a3b8; font-size: 0.9em;">Desvantagens:</strong><br>
                        ${classData.disadvantages.map(dis => `<span class="disadvantage-badge">-${dis}</span>`).join('')}
                    </div>
                    
                    <div class="class-skills">
                        <div class="skills-title">Skills Exclusivas:</div>
                        ${classData.skills.map(skill => `<span class="skill-item">${skill}</span>`).join('')}
                    </div>
                    
                    <div class="class-actions">
                        <button class="action-btn edit-btn" onclick="editClass('${classData.id}')">✏️ Editar</button>
                        <button class="action-btn delete-btn" onclick="deleteClass('${classData.id}')">🗑️ Excluir</button>
                    </div>
                </div>
            `).join('');
        }

        // Render classes as table
        function renderClassTable(classes) {
            const container = document.getElementById('classesGrid');
            const classesArray = Object.values(classes);
            
            container.innerHTML = `
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse; background: rgba(255, 255, 255, 0.05); border-radius: 8px;">
                        <thead>
                            <tr style="background: rgba(0, 0, 0, 0.3);">
                                <th style="padding: 12px; color: #41eadc; border-bottom: 2px solid rgba(65, 234, 212, 0.3);">ID</th>
                                <th style="padding: 12px; color: #41eadc; border-bottom: 2px solid rgba(65, 234, 212, 0.3);">Nome</th>
                                <th style="padding: 12px; color: #41eadc; border-bottom: 2px solid rgba(65, 234, 212, 0.3);">Arquétipo</th>
                                <th style="padding: 12px; color: #41eadc; border-bottom: 2px solid rgba(65, 234, 212, 0.3);">Raridade</th>
                                <th style="padding: 12px; color: #41eadc; border-bottom: 2px solid rgba(65, 234, 212, 0.3);">ATK</th>
                                <th style="padding: 12px; color: #41eadc; border-bottom: 2px solid rgba(65, 234, 212, 0.3);">DEF</th>
                                <th style="padding: 12px; color: #41eadc; border-bottom: 2px solid rgba(65, 234, 212, 0.3);">Ânima</th>
                                <th style="padding: 12px; color: #41eadc; border-bottom: 2px solid rgba(65, 234, 212, 0.3);">Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${classesArray.map(classData => `
                                <tr style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                                    <td style="padding: 10px; color: #e2e8f0; font-family: monospace;">${classData.id}</td>
                                    <td style="padding: 10px; color: #41eadc; font-weight: 600;">${classData.name}</td>
                                    <td style="padding: 10px; color: #cbd5e1;">${classData.archetype}</td>
                                    <td style="padding: 10px;">
                                        <span class="rarity-badge ${classData.rarity}">${classData.rarity}</span>
                                    </td>
                                    <td style="padding: 10px; color: #f87171; font-weight: 600;">${classData.stats.attack}x</td>
                                    <td style="padding: 10px; color: #60a5fa; font-weight: 600;">${classData.stats.defense}x</td>
                                    <td style="padding: 10px; color: #a855f7; font-weight: 600;">${classData.stats.anima}x</td>
                                    <td style="padding: 10px;">
                                        <button class="action-btn edit-btn" onclick="editClass('${classData.id}')">✏️</button>
                                        <button class="action-btn delete-btn" onclick="deleteClass('${classData.id}')">🗑️</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        // Setup event listeners
        function setupEventListeners() {
            // Search functionality
            document.getElementById('searchBox').addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                const filteredClasses = {};
                
                Object.entries(allClasses).forEach(([key, classData]) => {
                    if (classData.name.toLowerCase().includes(searchTerm) ||
                        classData.description.toLowerCase().includes(searchTerm) ||
                        classData.archetype.toLowerCase().includes(searchTerm)) {
                        filteredClasses[key] = classData;
                    }
                });
                
                renderClasses(filteredClasses);
            });

            // Rarity selection
            document.querySelectorAll('.rarity-badge').forEach(badge => {
                badge.addEventListener('click', function() {
                    document.querySelectorAll('.rarity-badge').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    document.getElementById('classRarity').value = this.dataset.rarity;
                });
            });

            // Stat sliders
            document.querySelectorAll('input[type="range"]').forEach(slider => {
                slider.addEventListener('input', function() {
                    const display = this.parentNode.querySelector('.stat-display');
                    display.textContent = parseFloat(this.value).toFixed(1) + 'x';
                });
            });

            // Form submissions
            document.getElementById('classGeneratorForm').addEventListener('submit', handleGeneratorSubmit);
            document.getElementById('manualClassForm').addEventListener('submit', handleManualSubmit);
        }

        // Handle generator form submission
        async function handleGeneratorSubmit(e) {
            e.preventDefault();
            
            if (!serverOnline) {
                showNotification('Servidor offline!', 'error');
                return;
            }

            const formData = {
                name: document.getElementById('className').value,
                archetype: document.getElementById('classArchetype').value,
                rarity: document.getElementById('classRarity').value,
                description: document.getElementById('classDescription').value,
                stats: {
                    attack: parseFloat(document.getElementById('statAttack').value),
                    defense: parseFloat(document.getElementById('statDefense').value),
                    anima: parseFloat(document.getElementById('statAnima').value),
                    speed: parseFloat(document.getElementById('statSpeed').value)
                }
            };

            try {
                showLoading(true);
                
                // Simulate class generation (will be replaced with actual API call)
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                const newClass = generateClassWithAlgorithm(formData);
                
                // Add to local storage (temporary)
                allClasses[newClass.id] = newClass;
                renderClasses(allClasses);
                
                clearGeneratorForm();
                showNotification(`Classe "${newClass.name}" gerada com sucesso!`, 'success');
                
            } catch (error) {
                console.error('Erro ao gerar classe:', error);
                showNotification('Erro ao gerar classe', 'error');
            } finally {
                showLoading(false);
            }
        }

        // Handle manual form submission
        async function handleManualSubmit(e) {
            e.preventDefault();
            
            const name = document.getElementById('manualName').value;
            const description = document.getElementById('manualDescription').value;
            
            const newClass = {
                id: `CLASS_${Date.now().toString().slice(-6)}`,
                name: name,
                description: description,
                archetype: 'manual',
                rarity: 'common',
                stats: {
                    attack: 1.0,
                    defense: 1.0,
                    anima: 1.0,
                    speed: 1.0
                },
                advantages: [],
                disadvantages: [],
                skills: [],
                created_at: new Date().toISOString()
            };
            
            allClasses[newClass.id] = newClass;
            renderClasses(allClasses);
            
            document.getElementById('manualClassForm').reset();
            showNotification(`Classe "${name}" criada com sucesso!`, 'success');
        }

        // Generate class with algorithm (mock implementation)
        function generateClassWithAlgorithm(formData) {
            const id = `GEN_${Date.now().toString().slice(-6)}`;
            
            // Basic algorithm - will be expanded
            const totalStats = formData.stats.attack + formData.stats.defense + formData.stats.anima + formData.stats.speed;
            const balanceFactor = 4.0 / totalStats; // Normalize to 4.0 total
            
            const balancedStats = {
                attack: Math.round((formData.stats.attack * balanceFactor) * 10) / 10,
                defense: Math.round((formData.stats.defense * balanceFactor) * 10) / 10,
                anima: Math.round((formData.stats.anima * balanceFactor) * 10) / 10,
                speed: Math.round((formData.stats.speed * balanceFactor) * 10) / 10
            };
            
            // Determine advantages/disadvantages based on archetype
            let advantages = [], disadvantages = [];
            
            switch(formData.archetype) {
                case 'combate':
                    advantages = ['Armamentista'];
                    disadvantages = ['Arcano'];
                    break;
                case 'magia':
                    advantages = ['Lutador'];
                    disadvantages = ['Armamentista'];
                    break;
                case 'suporte':
                    advantages = ['Arcano'];
                    disadvantages = ['Lutador'];
                    break;
                case 'hibrido':
                    advantages = ['Variável'];
                    disadvantages = ['Nenhuma'];
                    break;
            }
            
            return {
                id: id,
                name: formData.name,
                description: formData.description,
                archetype: formData.archetype,
                rarity: formData.rarity,
                stats: balancedStats,
                advantages: advantages,
                disadvantages: disadvantages,
                skills: [`Skill de ${formData.name}`],
                created_at: new Date().toISOString(),
                generated: true
            };
        }

        // Utility functions
        function setViewMode(mode) {
            viewMode = mode;
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderClasses(allClasses);
        }

        function refreshClasses() {
            loadClasses();
        }

        function clearGeneratorForm() {
            document.getElementById('classGeneratorForm').reset();
            document.querySelectorAll('.rarity-badge').forEach(b => b.classList.remove('active'));
            document.querySelector('.rarity-badge[data-rarity="common"]').classList.add('active');
            document.getElementById('classRarity').value = 'common';
            
            // Reset stat displays
            document.querySelectorAll('input[type="range"]').forEach(slider => {
                slider.value = '1.0';
                const display = slider.parentNode.querySelector('.stat-display');
                display.textContent = '1.0x';
            });
        }

        function editClass(id) {
            showNotification('Função de edição em desenvolvimento', 'info');
        }

        function deleteClass(id) {
            if (confirm(`Tem certeza que deseja excluir a classe ${allClasses[id]?.name}?`)) {
                delete allClasses[id];
                renderClasses(allClasses);
                showNotification('Classe excluída com sucesso', 'success');
            }
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification('ID copiado para a área de transferência!', 'success');
            }).catch(() => {
                showNotification('Erro ao copiar ID', 'error');
            });
        }

        function showLoading(show) {
            const indicator = document.getElementById('loadingIndicator');
            if (show) {
                indicator.classList.add('show');
            } else {
                indicator.classList.remove('show');
            }
        }

        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }
    </script>
</body>
</html>